<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SweetRoute Deluxe - Pedidos</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="navbar">
        <div class="titulo">SweetRoute Deluxe</div>
        <nav class="nav-links">
            <a href="index.html">Descripci√≥n</a>
            <a href="productos.html">Productos</a>
            <a href="pedidos.html" class="active">Pedidos</a>
        </nav>
        <div class="login-container">
            <button class="login-btn">LOGIN</button>
        </div>
    </header>

    <main>
        <div class="section-title-sub">¬°Tu Pedido!</div>

        <div class="pedido-container">
            <div class="map-column">
                <div class="section-title-sub section-title-inline">üìç Direcci√≥n de Entrega (La Molina)</div>
                <div class="google-maps-box">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d15340.487858485292!2d-76.9406541671941!3d-12.079201123485641!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x9105c6c06836154b%3A0xc6e469502759e0a0!2sLa%20Molina%2C%20Per%C3%BA!5e0!3m2!1ses-419!2spe!4v1700000000000!5m2!1ses-419!2spe" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>
            </div>

            <div class="form-column">
                <div class="section-title-sub section-title-inline">üìù Detalles y Confirmaci√≥n</div>

                <div class="form-box">
                    <label for="productos-pedidos">Productos Agregados:</label>
                    <textarea id="productos-pedidos" class="input-field" readonly>No hay productos en el carrito.</textarea>
                    
                    <div id="remove-product-container">
                        <button class="action-button remove-btn">Quitar Producto</button>
                        <input type="text" id="remove-product-name" class="input-field" placeholder="Escribe el nombre del producto a quitar y presiona Enter">
                    </div>

                    <label for="nombre">Nombre Completo:</label>
                    <input type="text" id="nombre" class="input-field" placeholder="Juan P√©rez">

                    <label for="direccion">Direcci√≥n de Entrega:</label>
                    <input type="text" id="direccion" class="input-field" placeholder="Av. Los Fresnos 123">

                    <label for="telefono">Tel√©fono:</label>
                    <input type="tel" id="telefono" class="input-field" placeholder="+51 987 654 321">

                    <label for="total">Total Estimado:</label>
                    <input type="text" id="total" class="input-field" value="$0.00" readonly>
                    
                    <button class="action-button confirm" id="confirmar-pedido">Finalizar Pedido</button>
                </div>
            </div>
        </div>
    </main>

    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <p>¬°Pedido Confirmado! ü•≥</p>
            <p>Gracias por tu compra. Te enviaremos un mensaje de confirmaci√≥n.</p>
            <button class="action-button confirm" id="close-modal-btn">Cerrar</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const productsTextarea = document.getElementById('productos-pedidos');
            const totalInput = document.getElementById('total');
            const removeInput = document.getElementById('remove-product-name');
            const removeButton = document.querySelector('.remove-btn');
            const confirmarButton = document.getElementById('confirmar-pedido');
            const modal = document.getElementById('confirm-modal');
            const closeModalButton = document.getElementById('close-modal-btn');

            // Funci√≥n para cargar/actualizar los productos y el total
            function loadAndDisplayProducts() {
                let pedidos = JSON.parse(localStorage.getItem('sweetRoutePedidos')) || [];
                
                if (pedidos.length === 0) {
                    productsTextarea.value = "No hay productos en el carrito.";
                    totalInput.value = "$0.00";
                    return;
                }

                let total = 0;
                let productList = [];

                pedidos.forEach(item => {
                    productList.push(item);
                    
                    // Extraer el precio (ejemplo: "Pastel ($18.50)")
                    const priceMatch = item.match(/\$([\d.]+)/);
                    if (priceMatch && priceMatch[1]) {
                        total += parseFloat(priceMatch[1]);
                    }
                });

                productsTextarea.value = productList.join('\n');
                totalInput.value = `$${total.toFixed(2)}`;
            }

            // --- L√≥gica de Eliminaci√≥n (NUEVA) ---

            // Eliminar al presionar Enter en el campo
            removeInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault(); // Evita el env√≠o del formulario si existiera
                    removeItemFromCart();
                }
            });

            // Eliminar al presionar el bot√≥n "Quitar Producto"
            removeButton.addEventListener('click', removeItemFromCart);

            function removeItemFromCart() {
                const productNameToRemove = removeInput.value.trim().toLowerCase();
                
                if (!productNameToRemove) {
                    alert("Por favor, introduce el nombre del producto que deseas quitar.");
                    return;
                }
                
                let pedidos = JSON.parse(localStorage.getItem('sweetRoutePedidos')) || [];
                let initialLength = pedidos.length;
                
                // Filtra la lista, manteniendo solo los que NO contienen el nombre a remover
                pedidos = pedidos.filter(item => 
                    !item.toLowerCase().includes(productNameToRemove)
                );
                
                if (pedidos.length < initialLength) {
                    // Si se elimin√≥ al menos un elemento
                    localStorage.setItem('sweetRoutePedidos', JSON.stringify(pedidos));
                    loadAndDisplayProducts();
                    removeInput.value = '';
                    alert(`‚úÖ Producto(s) con "${productNameToRemove}" quitado(s).`);
                } else {
                    alert(`‚ùå No se encontr√≥ ning√∫n producto con el nombre "${productNameToRemove}".`);
                }
            }

            // --- L√≥gica de Confirmaci√≥n ---
            
            confirmarButton.addEventListener('click', () => {
                // Validaci√≥n simple de campos
                const nombre = document.getElementById('nombre').value;
                const direccion = document.getElementById('direccion').value;
                const telefono = document.getElementById('telefono').value;
                
                if (!nombre || !direccion || !telefono) {
                    alert("Por favor, completa todos los campos de contacto y direcci√≥n antes de finalizar el pedido.");
                    return;
                }

                // Simular el proceso de pedido
                modal.style.display = "flex";
                
                // Opcional: Limpiar el carrito despu√©s de la confirmaci√≥n (descomentar para activar)
                // localStorage.removeItem('sweetRoutePedidos'); 
            });

            // L√≥gica para cerrar el modal
            closeModalButton.addEventListener('click', () => {
                modal.style.display = "none";
                // Recargar productos (mostrar√° "No hay productos" si se limpi√≥ el carrito)
                loadAndDisplayProducts(); 
            });

            // Carga inicial
            loadAndDisplayProducts();
        });
    </script>
</body>
</html>
