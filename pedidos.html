<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SweetRoute Deluxe - Pedidos</title>
    <link rel="stylesheet" href="styles.css"> 
</head>
<body>
    <header class="navbar">
        <div class="titulo">SweetRoute Deluxe</div>
        <nav class="nav-links">
            <a href="index.html">Descripción</a>
            <a href="productos.html">Productos</a>
            <a href="pedidos.html" class="active">Pedidos</a>
            <a href="contactanos.html">Contáctanos</a>
        </nav>
        <div class="login-container">
            <button class="login-btn">LOGIN</button>
        </div>
    </header>

    <main>
        <div class="section-title-sub">Pedidos</div> 

        <div class="pedido-container">
            <div class="map-column">
                <div class="section-title-sub">Ubicación de Entrega (La Molina)</div>
                
                <div class="google-maps-box">
                    <iframe 
                        src="http://googleusercontent.com/maps.google.com/6" 
                        width="100%" 
                        height="100%" 
                        frameborder="0" 
                        style="border:0;" 
                        allowfullscreen="" 
                        aria-hidden="false" 
                        tabindex="0">
                    </iframe>
                </div>
            </div>

            <div class="form-column">
                <div class="section-title-sub">Detalles del Pedido</div>

                <div class="form-box">
                    <label for="nombre">NOMBRE DEL QUE HACE EL PEDIDO:</label>
                    <input type="text" id="nombre" class="input-field" placeholder="Escribe tu nombre completo">

                    <a href="productos.html" class="action-button confirm" style="margin-top: 20px; display: block; text-align: center; text-decoration: none;">
                        UN BOTÓN DE AÑADIR PRODUCTO A PEDIR
                    </a>

                    <label for="productos">MOSTRAR PRODUCTOS PEDIDOS:</label>
                    <textarea id="productos-pedidos" class="input-field" rows="6" readonly></textarea>

                    <label for="direccion" style="margin-top: 20px;">DIRECCIÓN para la entrega:</label>
                    <input type="text" id="direccion" class="input-field" placeholder="Av. Principal 123, Urb. XXX">

                    <button id="confirmar-btn" class="action-button confirm" style="margin-top: 30px;">
                        Boton de confirmar pedido
                    </button>
                </div>
            </div>
        </div>

        <div id="modal-confirmacion" class="modal">
            <div class="modal-content">
                <p id="modal-mensaje"></p>
                <button onclick="cerrarModal()" class="action-button confirm">Aceptar</button>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const confirmarBtn = document.getElementById('confirmar-btn');
            const nombreInput = document.getElementById('nombre');
            const direccionInput = document.getElementById('direccion');
            const productosArea = document.getElementById('productos-pedidos');
            const modal = document.getElementById('modal-confirmacion');
            const modalMensaje = document.getElementById('modal-mensaje');

            // Función para cargar los productos seleccionados de localStorage
            function cargarProductos() {
                const productosSeleccionados = JSON.parse(localStorage.getItem('sweetRoutePedidos')) || [];
                
                if (productosSeleccionados.length === 0) {
                    productosArea.value = "Aún no has añadido ningún producto. Haz clic en 'Añadir Producto a Pedir'.";
                } else {
                    // Muestra cada producto en una nueva línea
                    productosArea.value = productosSeleccionados.join('\n');
                }
            }
            
            cargarProductos();

            confirmarBtn.addEventListener('click', (e) => {
                e.preventDefault();
                let falta = false;
                
                // Limpiar estilos de error previos
                nombreInput.style.borderColor = "";
                direccionInput.style.borderColor = "";
                nombreInput.placeholder = "Escribe tu nombre completo";
                direccionInput.placeholder = "Av. Principal 123, Urb. XXX";

                // 1. Validar Nombre
                if (nombreInput.value.trim() === "") {
                    nombreInput.placeholder = "¡FALTA el nombre!";
                    nombreInput.style.borderColor = "red";
                    falta = true;
                }

                // 2. Validar Dirección
                if (direccionInput.value.trim() === "") {
                    direccionInput.placeholder = "¡FALTA la dirección!";
                    direccionInput.style.borderColor = "red";
                    falta = true;
                }
                
                // 3. Validar si hay productos seleccionados
                const productosSeleccionados = JSON.parse(localStorage.getItem('sweetRoutePedidos')) || [];
                if (productosSeleccionados.length === 0) {
                    modalMensaje.textContent = "¡FALTA! No hay productos añadidos al pedido.";
                    abrirModal();
                    falta = true;
                }
                
                // 4. Mostrar resultado
                if (!falta) {
                    // Pedido Exitoso
                    modalMensaje.textContent = "¡Su pedido ha sido exitoso! Pronto lo recibirás.";
                    abrirModal();
                    
                    // Limpiar el carrito después de un pedido exitoso
                    localStorage.removeItem('sweetRoutePedidos');
                    // Actualizar el área de texto
                    productosArea.value = "Pedido enviado. Carrito vacío.";
                } else if (falta && productosSeleccionados.length > 0) {
                    // Solo falta nombre o dirección, y el modal no se abrió por falta de productos
                    // (La validación de Nombre/Dirección ya marcó los campos, que es lo que pediste)
                }
            });

            window.cerrarModal = () => {
                modal.style.display = "none";
            }
            
            function abrirModal() {
                modal.style.display = "flex";
            }
        });
    </script>
</body>
</html>
